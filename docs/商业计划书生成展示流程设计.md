# 商业计划书生成展示流程系统设计

## 核心理念

让用户在商业计划书生成过程中能够：
1. **实时了解进度** - 清晰知道当前进展到哪个阶段
2. **预览版本内容** - 查看每个阶段生成的具体内容
3. **对比不同版本** - 比较AI生成的多个方案版本
4. **参与优化过程** - 对生成内容进行反馈和调整

## 1. 整体流程架构

```
用户输入创意
    ↓
[创意分析阶段] → 生成概念解析 → 用户预览 → 确认/调整
    ↓
[市场调研阶段] → 生成市场分析 → 用户预览 → 确认/调整
    ↓
[技术架构阶段] → 生成技术方案 → 用户预览 → 确认/调整
    ↓
[商业模式阶段] → 生成商业模式 → 用户预览 → 确认/调整
    ↓
[财务建模阶段] → 生成财务预测 → 用户预览 → 确认/调整
    ↓
[合规评估阶段] → 生成合规报告 → 用户预览 → 确认/调整
    ↓
[实施规划阶段] → 生成执行计划 → 用户预览 → 确认/调整
    ↓
[投资推介阶段] → 生成BP演示 → 用户预览 → 确认/调整
    ↓
[整合优化阶段] → 生成完整方案 → 最终预览 → 下载/分享
```

## 2. 进度可视化系统

### 2.1 多层级进度展示

```typescript
interface ProgressDisplaySystem {
  // 整体进度
  overallProgress: {
    completedStages: number
    totalStages: number
    estimatedTimeRemaining: string
    currentPhase: string
  }

  // 当前阶段进度
  currentStageProgress: {
    stageId: string
    stageName: string
    progress: number // 0-100
    currentStep: string
    estimatedCompletion: Date
    aiProvider: string
  }

  // 子步骤进度
  subStepProgress: {
    steps: Array<{
      name: string
      status: 'pending' | 'in_progress' | 'completed' | 'error'
      startTime?: Date
      completionTime?: Date
    }>
  }
}
```

### 2.2 可视化组件设计

```tsx
// 主进度条组件
const BusinessPlanProgressTracker: React.FC = () => {
  return (
    <div className="w-full bg-background border rounded-lg p-6">
      {/* 整体进度条 */}
      <div className="mb-8">
        <div className="flex justify-between items-center mb-2">
          <h3 className="text-lg font-semibold">商业计划书生成进度</h3>
          <span className="text-sm text-muted-foreground">
            {overallProgress.completedStages}/{overallProgress.totalStages} 阶段完成
          </span>
        </div>
        <Progress value={overallProgress.percentage} className="h-3 mb-2" />
        <div className="flex justify-between text-xs text-muted-foreground">
          <span>当前阶段: {overallProgress.currentPhase}</span>
          <span>预计剩余: {overallProgress.estimatedTimeRemaining}</span>
        </div>
      </div>

      {/* 阶段时间轴 */}
      <StageTimeline stages={stages} currentStage={currentStageIndex} />

      {/* 当前阶段详细进度 */}
      <CurrentStageDetail stage={currentStage} />
    </div>
  )
}

// 阶段时间轴组件
const StageTimeline: React.FC = ({ stages, currentStage }) => {
  return (
    <div className="relative">
      {/* 连接线 */}
      <div className="absolute left-6 top-0 bottom-0 w-0.5 bg-gray-200" />

      {stages.map((stage, index) => (
        <div key={stage.id} className="relative flex items-center mb-4">
          {/* 阶段图标 */}
          <div className={`
            w-12 h-12 rounded-full flex items-center justify-center relative z-10
            ${getStageStatusStyle(stage.status)}
          `}>
            {getStageIcon(stage.status, stage.aiProvider)}
          </div>

          {/* 阶段信息 */}
          <div className="ml-4 flex-1">
            <div className="flex items-center justify-between">
              <h4 className="font-medium">{stage.name}</h4>
              <div className="flex items-center gap-2">
                <Badge variant="outline" className="text-xs">
                  {stage.aiProvider}
                </Badge>
                {stage.status === 'completed' && (
                  <Button size="sm" variant="ghost" onClick={() => previewStageContent(stage.id)}>
                    查看内容
                  </Button>
                )}
              </div>
            </div>

            {/* 阶段进度条 */}
            {stage.status === 'in_progress' && (
              <div className="mt-2">
                <Progress value={stage.progress} className="h-1" />
                <div className="flex justify-between text-xs text-muted-foreground mt-1">
                  <span>{stage.currentStep}</span>
                  <span>{stage.progress}%</span>
                </div>
              </div>
            )}

            {/* 完成时间 */}
            {stage.status === 'completed' && stage.completionTime && (
              <p className="text-xs text-green-600 mt-1">
                完成时间: {stage.completionTime.toLocaleTimeString()}
              </p>
            )}
          </div>
        </div>
      ))}
    </div>
  )
}

// 当前阶段详情组件
const CurrentStageDetail: React.FC = ({ stage }) => {
  if (!stage || stage.status !== 'in_progress') return null

  return (
    <Card className="mt-6 border-blue-200 bg-blue-50">
      <CardHeader>
        <CardTitle className="flex items-center gap-2 text-blue-800">
          <Activity className="w-5 h-5 animate-pulse" />
          正在生成: {stage.name}
        </CardTitle>
        <CardDescription className="text-blue-600">
          {stage.description}
        </CardDescription>
      </CardHeader>
      <CardContent>
        {/* 子步骤进度 */}
        <div className="space-y-2">
          {stage.subSteps.map((step, index) => (
            <div key={index} className="flex items-center gap-3">
              {getSubStepIcon(step.status)}
              <span className="text-sm">{step.name}</span>
              {step.status === 'in_progress' && (
                <div className="ml-auto flex items-center gap-2">
                  <Loader2 className="w-4 h-4 animate-spin" />
                  <span className="text-xs text-muted-foreground">处理中...</span>
                </div>
              )}
            </div>
          ))}
        </div>

        {/* AI实时反馈 */}
        {stage.aiInsights && (
          <div className="mt-4 p-3 bg-white rounded border">
            <h5 className="text-sm font-medium mb-2">AI实时洞察</h5>
            <ul className="space-y-1">
              {stage.aiInsights.map((insight, index) => (
                <li key={index} className="text-xs text-gray-600 flex items-start gap-1">
                  <Sparkles className="w-3 h-3 mt-0.5 text-yellow-500 flex-shrink-0" />
                  {insight}
                </li>
              ))}
            </ul>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

## 3. 版本内容管理系统

### 3.1 内容版本结构

```typescript
interface ContentVersion {
  id: string
  stageId: string
  version: number
  createdAt: Date
  aiProvider: string
  content: {
    title: string
    summary: string
    fullContent: string
    keyPoints: string[]
    attachments?: {
      type: 'chart' | 'table' | 'image'
      data: any
      description: string
    }[]
  }
  userFeedback?: {
    rating: number
    comments: string
    improvements: string[]
  }
  status: 'draft' | 'reviewed' | 'approved' | 'rejected'
}
```

### 3.2 版本对比和预览组件

```tsx
// 内容版本管理器
const ContentVersionManager: React.FC = ({ stageId }) => {
  const [versions, setVersions] = useState<ContentVersion[]>([])
  const [selectedVersions, setSelectedVersions] = useState<string[]>([])
  const [previewMode, setPreviewMode] = useState<'single' | 'compare'>('single')

  return (
    <div className="space-y-6">
      {/* 版本列表 */}
      <Card>
        <CardHeader>
          <div className="flex justify-between items-center">
            <CardTitle>生成内容版本</CardTitle>
            <div className="flex gap-2">
              <Button
                size="sm"
                variant={previewMode === 'single' ? 'default' : 'outline'}
                onClick={() => setPreviewMode('single')}
              >
                单版本预览
              </Button>
              <Button
                size="sm"
                variant={previewMode === 'compare' ? 'default' : 'outline'}
                onClick={() => setPreviewMode('compare')}
                disabled={selectedVersions.length < 2}
              >
                版本对比
              </Button>
            </div>
          </div>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {versions.map((version) => (
              <VersionCard
                key={version.id}
                version={version}
                selected={selectedVersions.includes(version.id)}
                onSelect={handleVersionSelect}
                onPreview={handleVersionPreview}
              />
            ))}
          </div>
        </CardContent>
      </Card>

      {/* 内容预览区域 */}
      {previewMode === 'single' && selectedVersions.length === 1 && (
        <SingleVersionPreview versionId={selectedVersions[0]} />
      )}

      {previewMode === 'compare' && selectedVersions.length >= 2 && (
        <VersionComparison versionIds={selectedVersions} />
      )}
    </div>
  )
}

// 版本卡片组件
const VersionCard: React.FC = ({ version, selected, onSelect, onPreview }) => {
  return (
    <Card className={`cursor-pointer transition-all ${
      selected ? 'ring-2 ring-blue-500 bg-blue-50' : 'hover:shadow-md'
    }`}>
      <CardContent className="p-4">
        <div className="flex justify-between items-start mb-3">
          <div className="flex items-center gap-2">
            <Checkbox
              checked={selected}
              onChange={() => onSelect(version.id)}
            />
            <Badge variant="outline">V{version.version}</Badge>
          </div>
          <Badge
            variant={getStatusVariant(version.status)}
            className="text-xs"
          >
            {version.status}
          </Badge>
        </div>

        <h4 className="font-medium text-sm mb-2">{version.content.title}</h4>
        <p className="text-xs text-muted-foreground mb-3 line-clamp-2">
          {version.content.summary}
        </p>

        <div className="flex justify-between items-center text-xs text-muted-foreground">
          <span>{version.aiProvider}</span>
          <span>{version.createdAt.toLocaleTimeString()}</span>
        </div>

        <div className="mt-3 flex gap-2">
          <Button size="sm" variant="outline" onClick={() => onPreview(version.id)}>
            预览
          </Button>
          <Button size="sm" variant="ghost" onClick={() => handleFeedback(version.id)}>
            反馈
          </Button>
        </div>
      </CardContent>
    </Card>
  )
}

// 单版本预览组件
const SingleVersionPreview: React.FC = ({ versionId }) => {
  const version = getVersionById(versionId)

  return (
    <Card>
      <CardHeader>
        <div className="flex justify-between items-center">
          <CardTitle className="flex items-center gap-2">
            <FileText className="w-5 h-5" />
            {version.content.title}
          </CardTitle>
          <div className="flex gap-2">
            <Badge>{version.aiProvider}</Badge>
            <Badge variant="outline">V{version.version}</Badge>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        {/* 关键点总结 */}
        <div className="mb-6">
          <h4 className="font-medium mb-2">关键要点</h4>
          <ul className="space-y-1">
            {version.content.keyPoints.map((point, index) => (
              <li key={index} className="flex items-start gap-2 text-sm">
                <CheckCircle className="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" />
                {point}
              </li>
            ))}
          </ul>
        </div>

        {/* 完整内容 */}
        <div className="prose max-w-none">
          <ReactMarkdown>{version.content.fullContent}</ReactMarkdown>
        </div>

        {/* 附件展示 */}
        {version.content.attachments && (
          <div className="mt-6">
            <h4 className="font-medium mb-2">相关附件</h4>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {version.content.attachments.map((attachment, index) => (
                <AttachmentPreview key={index} attachment={attachment} />
              ))}
            </div>
          </div>
        )}

        {/* 用户反馈区域 */}
        <div className="mt-6 border-t pt-6">
          <FeedbackSection versionId={versionId} feedback={version.userFeedback} />
        </div>
      </CardContent>
    </Card>
  )
}

// 版本对比组件
const VersionComparison: React.FC = ({ versionIds }) => {
  const versions = versionIds.map(id => getVersionById(id))

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <GitCompare className="w-5 h-5" />
          版本对比分析
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {versions.map((version, index) => (
            <div key={version.id} className="space-y-4">
              <div className="flex items-center gap-2">
                <Badge>V{version.version}</Badge>
                <Badge variant="outline">{version.aiProvider}</Badge>
                <span className="text-sm text-muted-foreground">
                  {version.createdAt.toLocaleString()}
                </span>
              </div>

              {/* 并排内容对比 */}
              <ComparisonContent version={version} />
            </div>
          ))}
        </div>

        {/* 差异分析 */}
        <div className="mt-6 pt-6 border-t">
          <h4 className="font-medium mb-4">差异分析</h4>
          <DifferenceAnalysis versions={versions} />
        </div>
      </CardContent>
    </Card>
  )
}
```

## 4. 用户交互体验

### 4.1 实时反馈系统

```tsx
// 用户反馈组件
const FeedbackSection: React.FC = ({ versionId, feedback }) => {
  return (
    <div className="space-y-4">
      <h4 className="font-medium">内容反馈</h4>

      {/* 评分 */}
      <div className="flex items-center gap-4">
        <span className="text-sm">内容质量:</span>
        <StarRating value={feedback?.rating || 0} onChange={handleRatingChange} />
      </div>

      {/* 评论 */}
      <div>
        <label className="text-sm font-medium">评论建议</label>
        <Textarea
          placeholder="对这个版本的内容有什么建议..."
          value={feedback?.comments || ''}
          onChange={handleCommentsChange}
          className="mt-1"
        />
      </div>

      {/* 改进建议 */}
      <div>
        <label className="text-sm font-medium">希望改进的方面</label>
        <div className="flex flex-wrap gap-2 mt-1">
          {IMPROVEMENT_OPTIONS.map(option => (
            <Badge
              key={option}
              variant={feedback?.improvements?.includes(option) ? 'default' : 'outline'}
              className="cursor-pointer"
              onClick={() => toggleImprovement(option)}
            >
              {option}
            </Badge>
          ))}
        </div>
      </div>

      {/* 操作按钮 */}
      <div className="flex gap-2">
        <Button onClick={handleApprove} className="flex items-center gap-2">
          <ThumbsUp className="w-4 h-4" />
          通过此版本
        </Button>
        <Button variant="outline" onClick={handleRequestRevision}>
          <RotateCcw className="w-4 h-4 mr-2" />
          请求修订
        </Button>
        <Button variant="outline" onClick={handleRegenerateWithFeedback}>
          <Sparkles className="w-4 h-4 mr-2" />
          基于反馈重新生成
        </Button>
      </div>
    </div>
  )
}
```

### 4.2 智能推荐系统

```typescript
// 基于用户反馈的智能推荐
class ContentRecommendationEngine {
  // 根据用户历史反馈推荐最佳版本
  recommendBestVersion(versions: ContentVersion[], userHistory: UserFeedbackHistory): ContentVersion {
    const scores = versions.map(version => {
      let score = 0

      // 基于用户评分历史
      if (userHistory.preferredAIProviders.includes(version.aiProvider)) {
        score += 20
      }

      // 基于内容质量指标
      score += this.calculateContentQuality(version)

      // 基于用户反馈模式
      score += this.calculateUserPreferenceMatch(version, userHistory)

      return { version, score }
    })

    return scores.sort((a, b) => b.score - a.score)[0].version
  }

  // 推荐需要改进的内容
  suggestImprovements(version: ContentVersion, feedback: UserFeedback): ImprovementSuggestion[] {
    const suggestions: ImprovementSuggestion[] = []

    if (feedback.rating < 3) {
      suggestions.push({
        type: 'quality_improvement',
        description: '建议重新生成此部分内容',
        priority: 'high'
      })
    }

    feedback.improvements.forEach(improvement => {
      suggestions.push({
        type: improvement,
        description: this.getImprovementDescription(improvement),
        priority: this.getImprovementPriority(improvement, feedback)
      })
    })

    return suggestions
  }
}
```

## 5. 完整的状态管理

```typescript
// 商业计划书生成状态管理
interface BusinessPlanGenerationState {
  // 进度状态
  overallProgress: OverallProgress
  currentStage: GenerationStage | null
  stages: GenerationStage[]

  // 内容版本
  stageVersions: Record<string, ContentVersion[]>
  selectedVersions: Record<string, string> // stageId -> versionId

  // 用户交互
  userFeedback: Record<string, UserFeedback>
  improvementSuggestions: ImprovementSuggestion[]

  // 操作方法
  startGeneration: (ideaData: IdeaData) => Promise<void>
  pauseGeneration: () => void
  resumeGeneration: () => void

  selectVersion: (stageId: string, versionId: string) => void
  submitFeedback: (versionId: string, feedback: UserFeedback) => void
  requestRevision: (versionId: string, requirements: string[]) => Promise<void>

  previewFinalPlan: () => BusinessPlanPreview
  exportPlan: (format: 'pdf' | 'docx' | 'html') => Promise<string>
}

const useBusinessPlanGeneration = create<BusinessPlanGenerationState>((set, get) => ({
  // ... 实现状态管理逻辑
}))
```

## 6. 最终整合界面

```tsx
// 主要的商业计划书生成界面
const BusinessPlanGenerationWorkspace: React.FC = ({ ideaData }) => {
  const {
    overallProgress,
    currentStage,
    stages,
    stageVersions,
    selectedVersions,
    startGeneration,
    selectVersion,
    submitFeedback
  } = useBusinessPlanGeneration()

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="container mx-auto py-8">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* 左侧：进度跟踪 */}
          <div className="lg:col-span-1">
            <div className="sticky top-8 space-y-6">
              <BusinessPlanProgressTracker />
              <QuickActions />
            </div>
          </div>

          {/* 右侧：内容预览和版本管理 */}
          <div className="lg:col-span-2">
            <div className="space-y-6">
              {/* 当前阶段内容 */}
              {currentStage && (
                <ContentVersionManager stageId={currentStage.id} />
              )}

              {/* 完整方案预览 */}
              {overallProgress.percentage === 100 && (
                <FinalPlanPreview />
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
```

## 总结

这个展示流程系统提供了：

1. **直观的进度可视化** - 多层级进度展示，实时状态更新
2. **丰富的内容版本管理** - 版本对比、预览、评价功能
3. **用户友好的交互体验** - 反馈收集、智能推荐、操作引导
4. **完整的状态管理** - 统一的数据流和操作接口
5. **专业的最终展示** - 整合预览、导出分享功能

这样用户就能清楚地知道方案设计进展，参与到内容优化过程中，获得满意的商业计划书成果。