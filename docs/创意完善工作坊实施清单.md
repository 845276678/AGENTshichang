# 创意完善工作坊 - 完整实施清单

> **文档版本**: v1.0
> **创建日期**: 2025-10-25
> **预计总时长**: 10-14小时
> **优先级**: 高

---

## 📋 总体进度概览

- [ ] **Phase 1**: 数据库和类型定义 (1-2小时)
- [ ] **Phase 2**: 核心业务逻辑和Context (2-3小时)
- [ ] **Phase 3**: UI组件开发 (3-4小时)
- [ ] **Phase 4**: API路由实现 (2-3小时)
- [ ] **Phase 5**: AI集成和Prompt工程 (1-2小时)
- [ ] **Phase 6**: 测试和优化 (1-2小时)

---

## Phase 1: 数据库和类型定义 (1-2小时)

### 1.1 更新Prisma Schema
**文件**: `prisma/schema.prisma`
**操作**: 添加新模型

```prisma
model IdeaRefinementDocument {
  id                  String   @id @default(cuid())
  userId              String   @map("user_id")
  user                User     @relation(fields: [userId], references: [id])

  // 基本信息
  ideaTitle           String   @map("idea_title")
  ideaContent         String   @db.Text @map("idea_content")
  biddingSessionId    String?  @map("bidding_session_id")

  // 评估结果
  evaluationScore     Json?    @map("evaluation_score")

  // 完善后的文档内容
  refinedDocument     Json     @map("refined_document")

  // 对话历史
  conversationHistory Json[]   @map("conversation_history")

  // 完善进度
  currentDimension    Int      @default(0) @map("current_dimension")
  currentRound        Int      @default(1) @map("current_round")
  completedDimensions String[] @map("completed_dimensions")
  progress            Float    @default(0)

  // 状态
  status              String   @default("IN_PROGRESS")

  // 时间戳
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  completedAt         DateTime? @map("completed_at")

  @@map("idea_refinement_documents")
  @@index([userId])
  @@index([status])
}
```

**任务清单**:
- [ ] 在schema.prisma中添加IdeaRefinementDocument模型
- [ ] 在User模型中添加关联: `refinementDocuments IdeaRefinementDocument[]`
- [ ] 运行 `npx prisma generate` 生成客户端
- [ ] 运行 `npx prisma migrate dev --name add_refinement_documents` 创建迁移
- [ ] 验证数据库表创建成功

**预计时间**: 30分钟

---

### 1.2 创建TypeScript类型定义
**文件**: `src/types/idea-refinement.ts`
**操作**: 创建新文件

**任务清单**:
- [ ] 创建 `Message` 接口（对话消息）
- [ ] 创建 `RefinedDocument` 接口（文档结构）
- [ ] 创建 `DimensionConfig` 接口（维度配置）
- [ ] 创建 `AIResponse` 接口（AI回复）
- [ ] 创建 `WorkshopStatus` 类型（状态枚举）

**预计时间**: 30分钟

---

## Phase 2: 核心业务逻辑和Context (2-3小时)

### 2.1 创建维度配置和模板
**文件**: `src/lib/idea-refinement/dimension-templates.ts`
**操作**: 创建新文件

**任务清单**:
- [ ] 定义6个维度的配置（名称、图标、字段）
- [ ] 创建每个维度的初始模板
- [ ] 创建字段验证规则
- [ ] 导出 `DIMENSIONS` 常量

**预计时间**: 30分钟

---

### 2.2 创建AI对话引擎
**文件**: `src/lib/idea-refinement/ai-dialogue-engine.ts`
**操作**: 创建新文件

**任务清单**:
- [ ] 创建 `IdeaRefinementAI` 类
- [ ] 实现 `generateDialogue` 方法
- [ ] 实现 `buildPrompt` 方法（根据维度和轮次）
- [ ] 实现 `autoComplete` 方法（自动完善短回复）
- [ ] 定义5轮对话策略（ROUND_STRATEGIES）
- [ ] 定义6个维度的Prompt模板（DIMENSION_PROMPTS）

**预计时间**: 1小时

---

### 2.3 创建自动完善逻辑
**文件**: `src/lib/idea-refinement/auto-completion.ts`
**操作**: 创建新文件

**任务清单**:
- [ ] 实现短回复检测（< 20字）
- [ ] 实现AI扩展逻辑
- [ ] 实现结构化数据生成
- [ ] 添加示例数据生成器

**预计时间**: 30分钟

---

### 2.4 创建导出格式化器
**文件**: `src/lib/idea-refinement/export-formatters.ts`
**操作**: 创建新文件

**任务清单**:
- [ ] 实现Markdown格式化器
- [ ] 实现TXT格式化器
- [ ] 添加文件名生成逻辑
- [ ] 添加元数据（生成时间、ID等）

**预计时间**: 30分钟

---

### 2.5 创建Context状态管理
**文件**: `src/contexts/IdeaRefinementContext.tsx`
**操作**: 创建新文件

**任务清单**:
- [ ] 创建Context和Provider
- [ ] 实现所有状态定义
- [ ] 实现 `initializeWorkshop` 方法
- [ ] 实现 `sendMessage` 方法
- [ ] 实现 `updateDocument` 方法
- [ ] 实现 `skipDimension` 方法
- [ ] 实现 `goToNextDimension` 方法
- [ ] 实现 `exportDocument` 方法
- [ ] 实现自动保存（防抖500ms）
- [ ] 添加页面加载时的状态恢复
- [ ] 创建 `useIdeaRefinement` Hook

**预计时间**: 1-1.5小时

---

## Phase 3: UI组件开发 (3-4小时)

### 3.1 创建主页面路由
**文件**: `src/app/workshops/idea-refinement/page.tsx`
**操作**: 创建新文件

**任务清单**:
- [ ] 设置客户端组件
- [ ] 实现懒加载逻辑
- [ ] 创建骨架屏组件
- [ ] 添加Provider包裹
- [ ] 设置页面元数据

**预计时间**: 30分钟

---

### 3.2 创建主容器组件
**文件**: `src/components/workshop/IdeaRefinementWorkshop.tsx`
**操作**: 创建新文件

**任务清单**:
- [ ] 实现双栏布局（5:7比例）
- [ ] 添加加载状态
- [ ] 添加保存状态指示器
- [ ] 集成子组件
- [ ] 添加响应式设计

**预计时间**: 30分钟

---

### 3.3 创建评估总结组件
**文件**: `src/components/workshop/EvaluationSummary.tsx`
**操作**: 创建新文件

**任务清单**:
- [ ] 显示综合评分
- [ ] 显示6个维度的评分
- [ ] 高亮薄弱维度（< 6.0分）
- [ ] 显示当前进度
- [ ] 添加完善进度条
- [ ] 添加完成标记

**预计时间**: 45分钟

---

### 3.4 创建AI对话面板组件
**文件**: `src/components/workshop/AIDialoguePanel.tsx`
**操作**: 创建新文件

**任务清单**:
- [ ] 实现对话消息列表
- [ ] 创建消息气泡子组件
- [ ] 添加自动滚动到最新消息
- [ ] 实现用户输入框
- [ ] 添加AI输入中动画
- [ ] 实现跳过维度按钮
- [ ] 添加轮次指示器
- [ ] 支持Enter发送、Shift+Enter换行

**预计时间**: 1小时

---

### 3.5 创建文档展示组件
**文件**: `src/components/workshop/RefinedDocumentView.tsx`
**操作**: 创建新文件

**任务清单**:
- [ ] 显示6个维度的文档区域
- [ ] 创建单个维度区域子组件
- [ ] 实现分区编辑（已完善可编辑）
- [ ] 添加字段编辑功能
- [ ] 显示维度状态（待完善/进行中/已完善）
- [ ] 添加实时更新动画
- [ ] 处理空数据显示

**预计时间**: 1小时

---

### 3.6 创建操作按钮组件
**文件**: `src/components/workshop/ActionButtons.tsx`
**操作**: 创建新文件

**任务清单**:
- [ ] 实现"完成当前维度"按钮
- [ ] 实现"保存并稍后继续"按钮
- [ ] 实现全部完成后的按钮组
  - 重新进入AI竞价
  - 进入MVP构建工作坊
  - 导出Markdown
  - 导出TXT
  - 保存并退出
- [ ] 添加完成状态提示

**预计时间**: 30分钟

---

## Phase 4: API路由实现 (2-3小时)

### 4.1 获取文档API
**文件**: `src/app/api/workshop/refinement/route.ts`
**方法**: GET
**操作**: 创建新文件

**任务清单**:
- [ ] 实现用户认证检查
- [ ] 查询用户的当前文档
- [ ] 判断是否有未完成文档
- [ ] 返回文档数据或空状态

**预计时间**: 20分钟

---

### 4.2 开始新文档API
**文件**: `src/app/api/workshop/refinement/start/route.ts`
**方法**: POST
**操作**: 创建新文件

**任务清单**:
- [ ] 验证请求数据
- [ ] 检查是否需要覆盖旧文档
- [ ] 创建新的文档记录
- [ ] 初始化6个维度的空结构
- [ ] 返回文档ID和初始内容

**预计时间**: 30分钟

---

### 4.3 发送消息API
**文件**: `src/app/api/workshop/refinement/message/route.ts`
**方法**: POST
**操作**: 创建新文件

**任务清单**:
- [ ] 验证请求数据
- [ ] 调用AI对话引擎
- [ ] 判断是否需要自动完善
- [ ] 更新对话历史
- [ ] 更新文档内容
- [ ] 返回AI回复和自动完善结果

**预计时间**: 45分钟

---

### 4.4 更新文档API
**文件**: `src/app/api/workshop/refinement/update/route.ts`
**方法**: PUT
**操作**: 创建新文件

**任务清单**:
- [ ] 验证请求数据
- [ ] 更新文档内容
- [ ] 更新对话历史
- [ ] 更新进度
- [ ] 返回成功状态

**预计时间**: 20分钟

---

### 4.5 导出文档API
**文件**: `src/app/api/workshop/refinement/export/route.ts`
**方法**: POST
**操作**: 创建新文件

**任务清单**:
- [ ] 验证请求数据
- [ ] 查询文档
- [ ] 调用格式化器（MD/TXT）
- [ ] 生成文件名
- [ ] 返回文件内容

**预计时间**: 20分钟

---

### 4.6 确认覆盖API
**文件**: `src/app/api/workshop/refinement/confirm-overwrite/route.ts`
**方法**: DELETE
**操作**: 创建新文件

**任务清单**:
- [ ] 验证请求数据
- [ ] 根据action执行操作：
  - export: 调用导出API
  - delete: 删除旧文档
  - continue: 返回旧文档
- [ ] 返回结果

**预计时间**: 15分钟

---

## Phase 5: AI集成和Prompt工程 (1-2小时)

### 5.1 定义AI Prompt模板
**文件**: `src/lib/idea-refinement/prompts.ts`
**操作**: 创建新文件

**任务清单**:
- [ ] 定义系统Prompt
- [ ] 定义6个维度的Prompt模板
- [ ] 定义5轮对话的策略Prompt
- [ ] 添加示例对话（Few-shot learning）
- [ ] 定义自动完善Prompt

**预计时间**: 45分钟

**Prompt结构示例**:
```typescript
export const DIMENSION_PROMPTS = {
  targetUsers: {
    name: '目标用户画像',
    systemPrompt: `你是创意完善工作坊的AI教练，专门帮助用户细化目标用户画像。`,
    round1: `分析评估报告，指出目标用户描述的薄弱点，提出开放式问题。`,
    round2: `追问用户群体的具体特征，如年龄、职业、收入、地域等。`,
    round3: `从多个角度分析：用户痛点、使用场景、购买动机、决策因素。`,
    round4: `给出3-5个具体建议，帮助完善用户画像。`,
    round5: `总结用户画像的完善成果，确认是否满意。`
  },
  // ... 其他5个维度
}
```

---

### 5.2 集成DeepSeek API
**文件**: `src/lib/idea-refinement/ai-dialogue-engine.ts`
**操作**: 完善AI调用逻辑

**任务清单**:
- [ ] 导入AIServiceManager
- [ ] 实现API调用逻辑
- [ ] 添加错误处理
- [ ] 添加重试机制
- [ ] 添加响应解析
- [ ] 添加成本统计

**预计时间**: 30分钟

---

### 5.3 测试AI对话质量
**操作**: 手动测试

**任务清单**:
- [ ] 测试简短回复的自动完善
- [ ] 测试详细回复的总结提炼
- [ ] 测试5轮对话的连贯性
- [ ] 测试跨维度的上下文记忆
- [ ] 调整Prompt优化回复质量

**预计时间**: 30分钟

---

## Phase 6: 测试和优化 (1-2小时)

### 6.1 功能测试
**任务清单**:
- [ ] 测试完整流程（输入→对话→完善→导出）
- [ ] 测试中途退出和恢复
- [ ] 测试新创意覆盖提示
- [ ] 测试手动编辑功能
- [ ] 测试跳过维度功能
- [ ] 测试导出功能（MD/TXT）
- [ ] 测试数据持久化
- [ ] 测试跨设备同步

**预计时间**: 45分钟

---

### 6.2 UI/UX测试
**任务清单**:
- [ ] 测试双栏布局在不同屏幕尺寸
- [ ] 测试消息滚动和自动定位
- [ ] 测试保存状态指示器
- [ ] 测试加载动画
- [ ] 测试错误提示
- [ ] 优化颜色和间距

**预计时间**: 30分钟

---

### 6.3 性能优化
**任务清单**:
- [ ] 检查组件渲染次数（React DevTools）
- [ ] 优化大列表渲染（虚拟滚动）
- [ ] 优化防抖逻辑
- [ ] 检查内存泄漏
- [ ] 优化AI调用频率

**预计时间**: 30分钟

---

## 📦 依赖检查

确保以下依赖已安装：

```json
{
  "dependencies": {
    "@prisma/client": "^5.x",
    "prisma": "^5.x",
    "framer-motion": "^10.x",
    "lucide-react": "^0.x",
    "react": "^18.x",
    "next": "^14.x"
  }
}
```

---

## 🚀 部署前检查清单

### 数据库
- [ ] Prisma迁移已应用到生产数据库
- [ ] 数据库索引正确创建
- [ ] 测试数据已清理

### 环境变量
- [ ] DATABASE_URL 已设置
- [ ] DEEPSEEK_API_KEY 已设置
- [ ] 其他必需的环境变量已设置

### 代码质量
- [ ] 没有TypeScript错误
- [ ] 没有ESLint警告
- [ ] 所有console.log已移除或改为debug
- [ ] 敏感信息已移除

### 功能验证
- [ ] 生产环境完整流程测试通过
- [ ] AI对话正常工作
- [ ] 数据持久化正常
- [ ] 导出功能正常

---

## 📝 开发注意事项

### 代码规范
1. 所有组件使用 TypeScript
2. 遵循项目现有的代码风格
3. 添加必要的注释
4. 使用有意义的变量名

### Git提交
1. 每完成一个Phase提交一次
2. 提交信息遵循约定格式
3. 大功能分多次小提交

### 测试策略
1. 边开发边测试（不等到最后）
2. 优先测试核心流程
3. 记录发现的bug

### 性能考虑
1. 避免不必要的重渲染
2. 合理使用useMemo和useCallback
3. 大数据使用分页或虚拟滚动

---

## 🎯 里程碑

### Milestone 1: 基础架构完成 (Day 1)
- ✅ 数据库Schema
- ✅ TypeScript类型
- ✅ 核心业务逻辑
- ✅ Context状态管理

### Milestone 2: UI组件完成 (Day 2)
- ✅ 所有UI组件
- ✅ 样式和交互
- ✅ 响应式布局

### Milestone 3: API和AI集成 (Day 2-3)
- ✅ 所有API路由
- ✅ AI对话引擎
- ✅ Prompt工程

### Milestone 4: 测试和上线 (Day 3)
- ✅ 功能测试
- ✅ 性能优化
- ✅ 部署上线

---

## 🆘 遇到问题时的检查顺序

1. **UI不更新**: 检查状态更新逻辑、React DevTools
2. **API报错**: 检查网络请求、服务器日志
3. **AI回复异常**: 检查Prompt、API响应
4. **数据库错误**: 检查Schema、迁移状态
5. **性能问题**: 检查渲染次数、网络请求

---

## 📚 相关文档链接

- [技术设计文档](./创意完善工作坊技术设计文档.md)
- [Prisma文档](https://www.prisma.io/docs)
- [Next.js文档](https://nextjs.org/docs)
- [DeepSeek API文档](https://platform.deepseek.com/docs)

---

**最后更新**: 2025-10-25
**维护者**: Claude Code
