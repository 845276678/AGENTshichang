# 用户个人中心设计规范文档

## 1. 页面概述

### 1.1 页面职责
用户个人中心是用户管理个人信息和平台互动的核心枢纽，负责：
- 展示用户的完整活动历史和成就
- 管理用户的创意作品和购买记录
- 提供钱包和交易管理功能
- 个性化设置和偏好管理

### 1.2 目标用户
- **活跃用户**：频繁使用平台功能的核心用户
- **创意提交者**：定期提交创意想法的用户
- **购买者**：经常购买Agent作品的用户
- **投资者**：关注收益和投资回报的用户

### 1.3 关键指标
- 用户留存率 > 75%
- 页面停留时间 > 5分钟
- 功能使用率 > 60%
- 用户满意度 > 4.5/5

## 2. 前端设计规范

### 2.1 页面结构

```tsx
// pages/profile/index.tsx
import { GetServerSideProps } from 'next';
import { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { ProfileHeader } from '@/components/profile/ProfileHeader';
import { ProfileNavigation } from '@/components/profile/ProfileNavigation';
import { DashboardOverview } from '@/components/profile/DashboardOverview';
import { MyIdeas } from '@/components/profile/MyIdeas';
import { MyPurchases } from '@/components/profile/MyPurchases';
import { WalletManagement } from '@/components/profile/WalletManagement';
import { AccountSettings } from '@/components/profile/AccountSettings';
import { AchievementsBadges } from '@/components/profile/AchievementsBadges';
import { useAuth } from '@/hooks/useAuth';

interface ProfilePageProps {
  userProfile: UserProfile;
  userStats: UserStats;
  recentActivities: Activity[];
  achievements: Achievement[];
  walletInfo: WalletInfo;
}

export default function ProfilePage({
  userProfile,
  userStats,
  recentActivities,
  achievements,
  walletInfo
}: ProfilePageProps) {
  const { user } = useAuth();
  const router = useRouter();
  const [activeTab, setActiveTab] = useState('overview');
  const [isEditing, setIsEditing] = useState(false);

  // 如果不是当前用户，重定向或显示公开信息
  useEffect(() => {
    if (!user || user.id !== userProfile.id) {
      // 如果是查看他人资料，显示公开信息
      if (router.query.userId && router.query.userId !== user?.id) {
        setActiveTab('public'); // 显示公开资料
      } else {
        router.push('/auth/login?redirect=/profile');
      }
    }
  }, [user, userProfile, router]);

  const navigationItems = [
    { id: 'overview', label: '概览', icon: 'dashboard' },
    { id: 'ideas', label: '我的创意', icon: 'lightbulb', badge: userStats.totalIdeas },
    { id: 'purchases', label: '我的购买', icon: 'shopping', badge: userStats.totalPurchases },
    { id: 'wallet', label: '钱包', icon: 'wallet' },
    { id: 'achievements', label: '成就', icon: 'trophy', badge: achievements.length },
    { id: 'settings', label: '设置', icon: 'settings' }
  ];

  return (
    <div className="profile-page min-h-screen bg-gray-50">
      {/* 个人资料头部 */}
      <ProfileHeader 
        user={userProfile}
        stats={userStats}
        isEditing={isEditing}
        onEditToggle={() => setIsEditing(!isEditing)}
        onProfileUpdate={handleProfileUpdate}
      />
      
      <div className="container mx-auto px-4 py-8">
        <div className="grid lg:grid-cols-4 gap-8">
          {/* 左侧导航 */}
          <div className="lg:col-span-1">
            <ProfileNavigation
              items={navigationItems}
              activeTab={activeTab}
              onTabChange={setActiveTab}
            />
          </div>
          
          {/* 主要内容区域 */}
          <div className="lg:col-span-3">
            <div className="bg-white rounded-lg shadow-sm border">
              {activeTab === 'overview' && (
                <DashboardOverview
                  userStats={userStats}
                  recentActivities={recentActivities}
                  walletInfo={walletInfo}
                />
              )}
              
              {activeTab === 'ideas' && (
                <MyIdeas
                  userId={userProfile.id}
                  onIdeaUpdate={handleIdeaUpdate}
                />
              )}
              
              {activeTab === 'purchases' && (
                <MyPurchases
                  userId={userProfile.id}
                  walletInfo={walletInfo}
                />
              )}
              
              {activeTab === 'wallet' && (
                <WalletManagement
                  walletInfo={walletInfo}
                  onWalletUpdate={handleWalletUpdate}
                />
              )}
              
              {activeTab === 'achievements' && (
                <AchievementsBadges
                  achievements={achievements}
                  userStats={userStats}
                />
              )}
              
              {activeTab === 'settings' && (
                <AccountSettings
                  userProfile={userProfile}
                  onSettingsUpdate={handleSettingsUpdate}
                />
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

export const getServerSideProps: GetServerSideProps = async (context) => {
  const session = await getSession(context);
  const userId = context.query.userId || session?.user?.id;
  
  if (!session && !context.query.userId) {
    return {
      redirect: {
        destination: '/auth/login?redirect=/profile',
        permanent: false
      }
    };
  }

  try {
    const [userProfile, userStats, recentActivities, achievements, walletInfo] = await Promise.all([
      fetchUserProfile(userId as string),
      fetchUserStats(userId as string),
      fetchRecentActivities(userId as string, 10),
      fetchUserAchievements(userId as string),
      session?.user?.id === userId ? fetchWalletInfo(userId as string) : null
    ]);

    if (!userProfile) {
      return { notFound: true };
    }

    return {
      props: {
        userProfile,
        userStats,
        recentActivities,
        achievements,
        walletInfo: walletInfo || {}
      }
    };
  } catch (error) {
    console.error('Failed to load profile page:', error);
    return { notFound: true };
  }
};
```

### 2.2 核心组件设计

#### 2.2.1 用户资料头部组件

```tsx
// components/profile/ProfileHeader.tsx
import { useState } from 'react';
import { motion } from 'framer-motion';
import { AvatarUpload } from '@/components/ui/AvatarUpload';
import { EditableField } from '@/components/ui/EditableField';
import { StatCard } from '@/components/ui/StatCard';
import { SocialLinks } from '@/components/ui/SocialLinks';

interface ProfileHeaderProps {
  user: UserProfile;
  stats: UserStats;
  isEditing: boolean;
  onEditToggle: () => void;
  onProfileUpdate: (data: Partial<UserProfile>) => Promise<void>;
}

export const ProfileHeader: React.FC<ProfileHeaderProps> = ({
  user,
  stats,
  isEditing,
  onEditToggle,
  onProfileUpdate
}) => {
  const [editData, setEditData] = useState({
    username: user.username,
    bio: user.bio,
    location: user.location,
    website: user.website
  });
  const [isUpdating, setIsUpdating] = useState(false);

  const handleSave = async () => {
    setIsUpdating(true);
    try {
      await onProfileUpdate(editData);
      onEditToggle();
    } catch (error) {
      console.error('Failed to update profile:', error);
    } finally {
      setIsUpdating(false);
    }
  };

  return (
    <div className="profile-header bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600 text-white">
      <div className="container mx-auto px-4 py-12">
        <div className="grid lg:grid-cols-3 gap-8 items-center">
          {/* 用户基本信息 */}
          <div className="lg:col-span-2">
            <div className="flex items-start space-x-6">
              {/* 头像 */}
              <div className="relative">
                <AvatarUpload
                  currentAvatar={user.avatar}
                  editable={isEditing}
                  onAvatarChange={(avatar) => setEditData({...editData, avatar})}
                  size="2xl"
                />
                {user.verifiedStatus && (
                  <div className="absolute -bottom-2 -right-2 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                    <CheckIcon className="w-5 h-5 text-white" />
                  </div>
                )}
              </div>
              
              {/* 用户信息 */}
              <div className="flex-1">
                <div className="flex items-center space-x-4 mb-2">
                  {isEditing ? (
                    <input
                      type="text"
                      value={editData.username}
                      onChange={(e) => setEditData({...editData, username: e.target.value})}
                      className="text-2xl font-bold bg-transparent border-b border-white/30 text-white placeholder-white/70"
                      placeholder="用户名"
                    />
                  ) : (
                    <h1 className="text-3xl font-bold">{user.username}</h1>
                  )}
                  
                  {user.level && (
                    <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">
                      {user.level.name}
                    </span>
                  )}
                </div>
                
                <div className="flex items-center space-x-4 text-white/80 mb-4">
                  <span>@{user.handle}</span>
                  {user.location && (
                    <>
                      <span>•</span>
                      {isEditing ? (
                        <input
                          type="text"
                          value={editData.location}
                          onChange={(e) => setEditData({...editData, location: e.target.value})}
                          className="bg-transparent border-b border-white/30 text-white placeholder-white/70"
                          placeholder="位置"
                        />
                      ) : (
                        <span>{user.location}</span>
                      )}
                    </>
                  )}
                  <span>•</span>
                  <span>加入于 {formatDate(user.createdAt)}</span>
                </div>
                
                {/* 用户简介 */}
                <div className="mb-4">
                  {isEditing ? (
                    <textarea
                      value={editData.bio}
                      onChange={(e) => setEditData({...editData, bio: e.target.value})}
                      rows={3}
                      className="w-full bg-white/10 border border-white/30 rounded-lg p-3 text-white placeholder-white/70 resize-none"
                      placeholder="介绍一下你自己..."
                    />
                  ) : (
                    <p className="text-lg leading-relaxed">{user.bio}</p>
                  )}
                </div>
                
                {/* 社交链接 */}
                <SocialLinks
                  links={user.socialLinks}
                  editable={isEditing}
                  onLinksChange={(links) => setEditData({...editData, socialLinks: links})}
                />
                
                {/* 编辑按钮 */}
                <div className="flex space-x-3 mt-6">
                  {isEditing ? (
                    <>
                      <button
                        onClick={handleSave}
                        disabled={isUpdating}
                        className="px-6 py-2 bg-green-500 hover:bg-green-600 rounded-lg font-medium transition-colors disabled:opacity-50"
                      >
                        {isUpdating ? '保存中...' : '保存'}
                      </button>
                      <button
                        onClick={onEditToggle}
                        className="px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg font-medium transition-colors"
                      >
                        取消
                      </button>
                    </>
                  ) : (
                    <button
                      onClick={onEditToggle}
                      className="px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg font-medium transition-colors"
                    >
                      编辑资料
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
          
          {/* 统计信息 */}
          <div className="lg:col-span-1">
            <div className="grid grid-cols-2 gap-4">
              <StatCard
                label="创意数量"
                value={stats.totalIdeas}
                change={stats.ideasGrowth}
                icon="lightbulb"
              />
              <StatCard
                label="总收益"
                value={`${stats.totalEarnings}积分`}
                change={stats.earningsGrowth}
                icon="currency"
              />
              <StatCard
                label="影响力"
                value={stats.influenceScore}
                change={stats.influenceGrowth}
                icon="trending"
              />
              <StatCard
                label="等级"
                value={user.level?.name || '新手'}
                progress={user.level?.progress}
                icon="star"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
```

#### 2.2.2 我的创意管理组件

```tsx
// components/profile/MyIdeas.tsx
import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { IdeaCard } from '@/components/ideas/IdeaCard';
import { IdeaFilters } from '@/components/ideas/IdeaFilters';
import { CreateIdeaModal } from '@/components/ideas/CreateIdeaModal';
import { IdeaAnalyticsModal } from '@/components/ideas/IdeaAnalyticsModal';

interface MyIdeasProps {
  userId: string;
  onIdeaUpdate: (idea: Idea) => void;
}

export const MyIdeas: React.FC<MyIdeasProps> = ({ userId, onIdeaUpdate }) => {
  const [ideas, setIdeas] = useState<Idea[]>([]);
  const [loading, setLoading] = useState(true);
  const [filters, setFilters] = useState({
    status: 'all',
    category: '',
    sortBy: 'created'
  });
  const [selectedIdea, setSelectedIdea] = useState<Idea | null>(null);
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [showAnalyticsModal, setShowAnalyticsModal] = useState(false);

  // 获取用户创意列表
  useEffect(() => {
    fetchMyIdeas();
  }, [filters]);

  const fetchMyIdeas = async () => {
    setLoading(true);
    try {
      const response = await fetch(`/api/users/${userId}/ideas?${new URLSearchParams(filters)}`);
      const data = await response.json();
      if (data.success) {
        setIdeas(data.data.ideas);
      }
    } catch (error) {
      console.error('Failed to fetch ideas:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleIdeaAction = async (action: string, ideaId: string) => {
    try {
      const response = await fetch(`/api/ideas/${ideaId}/${action}`, {
        method: 'POST'
      });
      
      if (response.ok) {
        fetchMyIdeas(); // 重新获取列表
      }
    } catch (error) {
      console.error(`Failed to ${action} idea:`, error);
    }
  };

  const getStatusColor = (status: string) => {
    const colors = {
      'draft': 'bg-gray-100 text-gray-800',
      'pending': 'bg-yellow-100 text-yellow-800',
      'in_discussion': 'bg-blue-100 text-blue-800',
      'completed': 'bg-green-100 text-green-800',
      'rejected': 'bg-red-100 text-red-800'
    };
    return colors[status] || 'bg-gray-100 text-gray-800';
  };

  return (
    <div className="my-ideas p-6">
      {/* 头部操作 */}
      <div className="flex items-center justify-between mb-6">
        <div>
          <h2 className="text-2xl font-bold text-gray-900">我的创意</h2>
          <p className="text-gray-600">管理你提交的所有创意想法</p>
        </div>
        <button
          onClick={() => setShowCreateModal(true)}
          className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
        >
          + 新建创意
        </button>
      </div>

      {/* 筛选器 */}
      <IdeaFilters
        filters={filters}
        onFiltersChange={setFilters}
        showStatusFilter={true}
      />

      {/* 创意列表 */}
      <div className="mt-6">
        {loading ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {[...Array(6)].map((_, i) => (
              <div key={i} className="animate-pulse">
                <div className="bg-gray-200 rounded-lg h-64"></div>
              </div>
            ))}
          </div>
        ) : ideas.length === 0 ? (
          <div className="text-center py-12">
            <div className="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
              <LightbulbIcon className="w-12 h-12 text-gray-400" />
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-2">
              还没有创意
            </h3>
            <p className="text-gray-600 mb-6">
              开始你的第一个创意，让AI专家们帮你实现它
            </p>
            <button
              onClick={() => setShowCreateModal(true)}
              className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
            >
              创建第一个创意
            </button>
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <AnimatePresence>
              {ideas.map((idea) => (
                <motion.div
                  key={idea.id}
                  layout
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -20 }}
                  transition={{ duration: 0.3 }}
                >
                  <IdeaCard
                    idea={idea}
                    showOwnerActions={true}
                    onEdit={() => setSelectedIdea(idea)}
                    onAnalytics={() => {
                      setSelectedIdea(idea);
                      setShowAnalyticsModal(true);
                    }}
                    onStatusChange={(status) => handleIdeaAction('updateStatus', idea.id)}
                    onDelete={() => handleIdeaAction('delete', idea.id)}
                  />
                </motion.div>
              ))}
            </AnimatePresence>
          </div>
        )}
      </div>

      {/* 创建创意模态框 */}
      <CreateIdeaModal
        isOpen={showCreateModal}
        onClose={() => setShowCreateModal(false)}
        onSuccess={(newIdea) => {
          setIdeas([newIdea, ...ideas]);
          setShowCreateModal(false);
        }}
      />

      {/* 创意分析模态框 */}
      {selectedIdea && (
        <IdeaAnalyticsModal
          idea={selectedIdea}
          isOpen={showAnalyticsModal}
          onClose={() => {
            setShowAnalyticsModal(false);
            setSelectedIdea(null);
          }}
        />
      )}
    </div>
  );
};
```

#### 2.2.3 钱包管理组件

```tsx
// components/profile/WalletManagement.tsx
import { useState } from 'react';
import { motion } from 'framer-motion';
import { WalletBalance } from '@/components/wallet/WalletBalance';
import { TransactionHistory } from '@/components/wallet/TransactionHistory';
import { WithdrawModal } from '@/components/wallet/WithdrawModal';
import { DepositModal } from '@/components/wallet/DepositModal';
import { PaymentMethodsModal } from '@/components/wallet/PaymentMethodsModal';

interface WalletManagementProps {
  walletInfo: WalletInfo;
  onWalletUpdate: (walletInfo: WalletInfo) => void;
}

export const WalletManagement: React.FC<WalletManagementProps> = ({
  walletInfo,
  onWalletUpdate
}) => {
  const [activeModal, setActiveModal] = useState<string | null>(null);
  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);

  const walletStats = [
    {
      label: '可用余额',
      value: `${walletInfo.balance.toLocaleString()}积分`,
      change: walletInfo.balanceChange24h,
      color: 'text-green-600'
    },
    {
      label: '待处理',
      value: `${walletInfo.pendingBalance.toLocaleString()}积分`,
      change: null,
      color: 'text-yellow-600'
    },
    {
      label: '本月收入',
      value: `${walletInfo.monthlyIncome.toLocaleString()}积分`,
      change: walletInfo.incomeGrowth,
      color: 'text-blue-600'
    },
    {
      label: '本月支出',
      value: `${walletInfo.monthlyExpense.toLocaleString()}积分`,
      change: walletInfo.expenseGrowth,
      color: 'text-red-600'
    }
  ];

  return (
    <div className="wallet-management p-6">
      {/* 头部 */}
      <div className="flex items-center justify-between mb-8">
        <div>
          <h2 className="text-2xl font-bold text-gray-900">钱包管理</h2>
          <p className="text-gray-600">管理你的积分余额和交易记录</p>
        </div>
        <div className="flex space-x-3">
          <button
            onClick={() => setActiveModal('deposit')}
            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
          >
            充值
          </button>
          <button
            onClick={() => setActiveModal('withdraw')}
            className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
          >
            提现
          </button>
          <button
            onClick={() => setActiveModal('payment-methods')}
            className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
          >
            支付方式
          </button>
        </div>
      </div>

      {/* 钱包统计卡片 */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        {walletStats.map((stat, index) => (
          <motion.div
            key={stat.label}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3, delay: index * 0.1 }}
            className="bg-white p-6 rounded-lg border shadow-sm"
          >
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 mb-1">{stat.label}</p>
                <p className={`text-2xl font-bold ${stat.color}`}>
                  {stat.value}
                </p>
                {stat.change !== null && (
                  <p className={`text-sm mt-1 ${
                    stat.change >= 0 ? 'text-green-600' : 'text-red-600'
                  }`}>
                    {stat.change >= 0 ? '+' : ''}{stat.change}%
                  </p>
                )}
              </div>
              <div className="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                <WalletIcon className="w-6 h-6 text-gray-600" />
              </div>
            </div>
          </motion.div>
        ))}
      </div>

      {/* 余额趋势图 */}
      <div className="mb-8">
        <WalletBalance
          balanceHistory={walletInfo.balanceHistory}
          currentBalance={walletInfo.balance}
          timeRange="30d"
        />
      </div>

      {/* 交易历史 */}
      <div>
        <h3 className="text-xl font-semibold text-gray-900 mb-4">交易历史</h3>
        <TransactionHistory
          transactions={walletInfo.transactions}
          onTransactionClick={setSelectedTransaction}
          showPagination={true}
        />
      </div>

      {/* 模态框 */}
      <DepositModal
        isOpen={activeModal === 'deposit'}
        onClose={() => setActiveModal(null)}
        onSuccess={onWalletUpdate}
        paymentMethods={walletInfo.paymentMethods}
      />

      <WithdrawModal
        isOpen={activeModal === 'withdraw'}
        onClose={() => setActiveModal(null)}
        onSuccess={onWalletUpdate}
        currentBalance={walletInfo.balance}
        withdrawMethods={walletInfo.withdrawMethods}
      />

      <PaymentMethodsModal
        isOpen={activeModal === 'payment-methods'}
        onClose={() => setActiveModal(null)}
        paymentMethods={walletInfo.paymentMethods}
        onUpdate={onWalletUpdate}
      />
    </div>
  );
};
```

### 2.3 数据类型定义

```typescript
// types/profile.ts
export interface UserProfile {
  id: string;
  username: string;
  handle: string;
  email: string;
  avatar: string;
  bio: string;
  location: string;
  website: string;
  socialLinks: {
    twitter?: string;
    linkedin?: string;
    github?: string;
    personal?: string;
  };
  level: {
    name: string;
    level: number;
    progress: number;
    nextLevel: string;
    requiredXP: number;
    currentXP: number;
  };
  verifiedStatus: boolean;
  createdAt: string;
  updatedAt: string;
  preferences: UserPreferences;
  privacy: PrivacySettings;
}

export interface UserStats {
  totalIdeas: number;
  totalPurchases: number;
  totalEarnings: number;
  influenceScore: number;
  ideasGrowth: number;
  earningsGrowth: number;
  influenceGrowth: number;
  averageRating: number;
  successRate: number;
  monthlyActive: boolean;
}

export interface WalletInfo {
  balance: number;
  pendingBalance: number;
  balanceChange24h: number;
  monthlyIncome: number;
  monthlyExpense: number;
  incomeGrowth: number;
  expenseGrowth: number;
  balanceHistory: {
    date: string;
    balance: number;
  }[];
  transactions: Transaction[];
  paymentMethods: PaymentMethod[];
  withdrawMethods: WithdrawMethod[];
}

export interface Achievement {
  id: string;
  name: string;
  description: string;
  icon: string;
  type: 'milestone' | 'streak' | 'special';
  rarity: 'common' | 'rare' | 'epic' | 'legendary';
  unlockedAt: string;
  progress?: {
    current: number;
    target: number;
  };
  reward?: {
    type: 'points' | 'badge' | 'feature';
    value: number | string;
  };
}

export interface Activity {
  id: string;
  type: 'idea_submitted' | 'idea_discussed' | 'purchase_made' | 'achievement_unlocked' | 'level_up';
  title: string;
  description: string;
  timestamp: string;
  metadata?: {
    ideaId?: string;
    productId?: string;
    achievementId?: string;
    amount?: number;
  };
  icon: string;
  link?: string;
}

export interface UserPreferences {
  notifications: {
    email: boolean;
    push: boolean;
    sms: boolean;
    categories: {
      discussions: boolean;
      purchases: boolean;
      achievements: boolean;
      marketing: boolean;
    };
  };
  display: {
    theme: 'light' | 'dark' | 'auto';
    language: string;
    timezone: string;
  };
  privacy: {
    showProfile: boolean;
    showStats: boolean;
    showActivity: boolean;
  };
}

export interface PrivacySettings {
  profileVisibility: 'public' | 'friends' | 'private';
  showEmail: boolean;
  showLocation: boolean;
  showSocialLinks: boolean;
  allowDirectMessages: boolean;
  allowNotifications: boolean;
  dataSharing: {
    analytics: boolean;
    marketing: boolean;
    research: boolean;
  };
}
```

## 3. 后端API规范

### 3.1 用户资料管理

```typescript
// GET /api/users/[userId]/profile
export interface UserProfileResponse {
  success: boolean;
  data: {
    profile: UserProfile;
    stats: UserStats;
    isOwnProfile: boolean;
    canEdit: boolean;
  };
}

export async function GET(
  request: Request,
  { params }: { params: { userId: string } }
) {
  try {
    const session = await getSession(request);
    const { userId } = params;
    const isOwnProfile = session?.user?.id === userId;

    // 获取用户基本信息
    const user = await prisma.user.findUnique({
      where: { id: userId },
      include: {
        level: true,
        preferences: true,
        privacy: true
      }
    });

    if (!user) {
      return NextResponse.json(
        { success: false, error: 'User not found' },
        { status: 404 }
      );
    }

    // 检查隐私设置
    if (!isOwnProfile && user.privacy.profileVisibility === 'private') {
      return NextResponse.json(
        { success: false, error: 'Profile is private' },
        { status: 403 }
      );
    }

    // 获取用户统计数据
    const stats = await calculateUserStats(userId);

    // 根据隐私设置过滤数据
    const profile = filterProfileByPrivacy(user, isOwnProfile);

    return NextResponse.json({
      success: true,
      data: {
        profile,
        stats: isOwnProfile || user.privacy.showStats ? stats : {},
        isOwnProfile,
        canEdit: isOwnProfile
      }
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to fetch profile' },
      { status: 500 }
    );
  }
}

// PUT /api/users/[userId]/profile
export interface UpdateProfileRequest {
  username?: string;
  bio?: string;
  location?: string;
  website?: string;
  socialLinks?: UserProfile['socialLinks'];
  avatar?: string;
}

export async function PUT(
  request: Request,
  { params }: { params: { userId: string } }
) {
  try {
    const session = await getSession(request);
    const { userId } = params;

    if (!session || session.user.id !== userId) {
      return NextResponse.json(
        { success: false, error: 'Unauthorized' },
        { status: 401 }
      );
    }

    const updateData: UpdateProfileRequest = await request.json();

    // 验证数据
    const validation = validateProfileData(updateData);
    if (!validation.valid) {
      return NextResponse.json(
        { success: false, error: validation.errors },
        { status: 400 }
      );
    }

    // 检查用户名唯一性
    if (updateData.username) {
      const existingUser = await prisma.user.findFirst({
        where: {
          username: updateData.username,
          id: { not: userId }
        }
      });

      if (existingUser) {
        return NextResponse.json(
          { success: false, error: 'Username already taken' },
          { status: 400 }
        );
      }
    }

    // 更新用户信息
    const updatedUser = await prisma.user.update({
      where: { id: userId },
      data: updateData,
      include: {
        level: true,
        preferences: true,
        privacy: true
      }
    });

    return NextResponse.json({
      success: true,
      data: { profile: updatedUser }
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to update profile' },
      { status: 500 }
    );
  }
}
```

### 3.2 钱包管理API

```typescript
// GET /api/users/[userId]/wallet
export interface WalletInfoResponse {
  success: boolean;
  data: WalletInfo;
}

export async function GET(
  request: Request,
  { params }: { params: { userId: string } }
) {
  try {
    const session = await getSession(request);
    const { userId } = params;

    if (!session || session.user.id !== userId) {
      return NextResponse.json(
        { success: false, error: 'Unauthorized' },
        { status: 401 }
      );
    }

    // 获取钱包信息
    const wallet = await prisma.userWallet.findUnique({
      where: { userId },
      include: {
        transactions: {
          orderBy: { createdAt: 'desc' },
          take: 50
        },
        paymentMethods: true
      }
    });

    if (!wallet) {
      // 创建钱包
      const newWallet = await prisma.userWallet.create({
        data: { userId, balance: 0 },
        include: {
          transactions: true,
          paymentMethods: true
        }
      });
      return NextResponse.json({
        success: true,
        data: formatWalletInfo(newWallet)
      });
    }

    // 计算统计数据
    const walletStats = await calculateWalletStats(userId);
    const walletInfo = {
      ...formatWalletInfo(wallet),
      ...walletStats
    };

    return NextResponse.json({
      success: true,
      data: walletInfo
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to fetch wallet info' },
      { status: 500 }
    );
  }
}

// POST /api/users/[userId]/wallet/deposit
export interface DepositRequest {
  amount: number;
  paymentMethodId: string;
  currency: 'CNY' | 'USD';
}

export async function POST(
  request: Request,
  { params }: { params: { userId: string } }
) {
  try {
    const session = await getSession(request);
    const { userId } = params;

    if (!session || session.user.id !== userId) {
      return NextResponse.json(
        { success: false, error: 'Unauthorized' },
        { status: 401 }
      );
    }

    const { amount, paymentMethodId, currency }: DepositRequest = await request.json();

    // 验证金额
    if (amount <= 0 || amount > 10000) {
      return NextResponse.json(
        { success: false, error: 'Invalid deposit amount' },
        { status: 400 }
      );
    }

    // 验证支付方式
    const paymentMethod = await prisma.paymentMethod.findFirst({
      where: { id: paymentMethodId, userId }
    });

    if (!paymentMethod) {
      return NextResponse.json(
        { success: false, error: 'Invalid payment method' },
        { status: 400 }
      );
    }

    // 创建充值订单
    const depositOrder = await prisma.depositOrder.create({
      data: {
        userId,
        amount,
        currency,
        paymentMethodId,
        status: 'pending',
        expiresAt: new Date(Date.now() + 30 * 60 * 1000) // 30分钟过期
      }
    });

    // 调用支付服务
    const paymentResult = await processPayment({
      orderId: depositOrder.id,
      amount,
      currency,
      paymentMethod
    });

    if (paymentResult.success) {
      // 更新钱包余额
      await prisma.$transaction([
        prisma.userWallet.update({
          where: { userId },
          data: { balance: { increment: amount } }
        }),
        prisma.transaction.create({
          data: {
            userId,
            type: 'deposit',
            amount,
            description: `Deposit ${amount} ${currency}`,
            status: 'completed',
            orderId: depositOrder.id
          }
        }),
        prisma.depositOrder.update({
          where: { id: depositOrder.id },
          data: { status: 'completed', completedAt: new Date() }
        })
      ]);

      return NextResponse.json({
        success: true,
        data: {
          orderId: depositOrder.id,
          amount,
          newBalance: await getUserBalance(userId)
        }
      });
    } else {
      return NextResponse.json(
        { success: false, error: 'Payment failed' },
        { status: 400 }
      );
    }
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to process deposit' },
      { status: 500 }
    );
  }
}
```

### 3.3 成就系统API

```typescript
// GET /api/users/[userId]/achievements
export interface AchievementsResponse {
  success: boolean;
  data: {
    achievements: Achievement[];
    unlockedCount: number;
    totalCount: number;
    nextAchievements: Achievement[];
  };
}

export async function GET(
  request: Request,
  { params }: { params: { userId: string } }
) {
  try {
    const { userId } = params;

    // 获取用户已解锁的成就
    const userAchievements = await prisma.userAchievement.findMany({
      where: { userId },
      include: { achievement: true },
      orderBy: { unlockedAt: 'desc' }
    });

    // 获取所有可用成就
    const allAchievements = await prisma.achievement.findMany({
      where: { isActive: true }
    });

    // 计算进度中的成就
    const progressAchievements = await calculateAchievementProgress(userId);

    const unlockedAchievements = userAchievements.map(ua => ({
      ...ua.achievement,
      unlockedAt: ua.unlockedAt
    }));

    const nextAchievements = allAchievements
      .filter(a => !unlockedAchievements.find(ua => ua.id === a.id))
      .slice(0, 5);

    return NextResponse.json({
      success: true,
      data: {
        achievements: unlockedAchievements,
        unlockedCount: unlockedAchievements.length,
        totalCount: allAchievements.length,
        nextAchievements: nextAchievements.map(a => ({
          ...a,
          progress: progressAchievements[a.id] || { current: 0, target: a.target }
        }))
      }
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to fetch achievements' },
      { status: 500 }
    );
  }
}

// 成就检查和解锁服务
export class AchievementService {
  private prisma: PrismaClient;

  constructor() {
    this.prisma = new PrismaClient();
  }

  // 检查用户成就进度
  async checkUserAchievements(userId: string, trigger: string, metadata?: any) {
    try {
      // 获取相关成就
      const achievements = await this.prisma.achievement.findMany({
        where: {
          trigger,
          isActive: true
        }
      });

      for (const achievement of achievements) {
        const hasAchievement = await this.prisma.userAchievement.findFirst({
          where: { userId, achievementId: achievement.id }
        });

        if (!hasAchievement) {
          const progress = await this.calculateProgress(userId, achievement, metadata);
          
          if (progress.current >= progress.target) {
            await this.unlockAchievement(userId, achievement.id);
          }
        }
      }
    } catch (error) {
      console.error('Failed to check achievements:', error);
    }
  }

  // 解锁成就
  private async unlockAchievement(userId: string, achievementId: string) {
    const achievement = await this.prisma.achievement.findUnique({
      where: { id: achievementId }
    });

    if (!achievement) return;

    // 解锁成就
    await this.prisma.userAchievement.create({
      data: {
        userId,
        achievementId,
        unlockedAt: new Date()
      }
    });

    // 发放奖励
    if (achievement.reward) {
      await this.grantReward(userId, achievement.reward);
    }

    // 发送通知
    await this.sendAchievementNotification(userId, achievement);

    // 记录活动
    await this.prisma.activity.create({
      data: {
        userId,
        type: 'achievement_unlocked',
        title: `解锁成就：${achievement.name}`,
        description: achievement.description,
        metadata: { achievementId }
      }
    });
  }

  // 计算成就进度
  private async calculateProgress(userId: string, achievement: Achievement, metadata?: any) {
    const userStats = await this.getUserStats(userId);
    
    switch (achievement.type) {
      case 'idea_count':
        return {
          current: userStats.totalIdeas,
          target: achievement.target
        };
      case 'earning_total':
        return {
          current: userStats.totalEarnings,
          target: achievement.target
        };
      case 'streak_days':
        return {
          current: await this.calculateStreak(userId),
          target: achievement.target
        };
      default:
        return { current: 0, target: achievement.target };
    }
  }
}
```

## 4. 移动端适配

### 4.1 移动端个人中心

```tsx
// components/profile/MobileProfileInterface.tsx
export const MobileProfileInterface: React.FC = () => {
  const [activeTab, setActiveTab] = useState('overview');

  return (
    <div className="mobile-profile h-full flex flex-col">
      {/* 移动端资料头部 */}
      <div className="bg-gradient-to-br from-blue-600 to-purple-600 text-white p-4">
        <div className="flex items-center space-x-4">
          <img 
            src={user.avatar} 
            alt={user.username}
            className="w-16 h-16 rounded-full border-2 border-white"
          />
          <div className="flex-1">
            <h2 className="text-xl font-bold">{user.username}</h2>
            <p className="text-white/80">@{user.handle}</p>
            <div className="flex items-center space-x-4 mt-2 text-sm">
              <span>{stats.totalIdeas} 创意</span>
              <span>{stats.totalEarnings} 积分</span>
            </div>
          </div>
        </div>
      </div>

      {/* 标签导航 */}
      <div className="flex bg-white border-b overflow-x-auto">
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            className={`px-4 py-3 text-sm font-medium whitespace-nowrap ${
              activeTab === tab.id 
                ? 'text-blue-600 border-b-2 border-blue-600' 
                : 'text-gray-600'
            }`}
          >
            {tab.label}
            {tab.badge && (
              <span className="ml-1 px-2 py-1 bg-gray-200 text-xs rounded-full">
                {tab.badge}
              </span>
            )}
          </button>
        ))}
      </div>

      {/* 内容区域 */}
      <div className="flex-1 overflow-y-auto">
        {activeTab === 'overview' && <MobileDashboard />}
        {activeTab === 'ideas' && <MobileMyIdeas />}
        {activeTab === 'wallet' && <MobileWallet />}
        {activeTab === 'settings' && <MobileSettings />}
      </div>
    </div>
  );
};
```

## 5. 性能优化

### 5.1 数据缓存策略

```typescript
// lib/cache/ProfileCache.ts
export class ProfileCache {
  private redis: Redis;
  private memoryCache: Map<string, any>;

  constructor() {
    this.redis = new Redis(process.env.REDIS_URL);
    this.memoryCache = new Map();
  }

  // 用户资料缓存
  async getUserProfile(userId: string, bypassCache = false) {
    const cacheKey = `profile:${userId}`;
    
    if (!bypassCache) {
      // 尝试内存缓存
      const memoryData = this.memoryCache.get(cacheKey);
      if (memoryData) return memoryData;
      
      // 尝试Redis缓存
      const redisData = await this.redis.get(cacheKey);
      if (redisData) {
        const data = JSON.parse(redisData);
        this.memoryCache.set(cacheKey, data);
        return data;
      }
    }

    // 从数据库获取
    const profile = await this.fetchProfileFromDB(userId);
    
    // 缓存数据
    await this.redis.setex(cacheKey, 300, JSON.stringify(profile)); // 5分钟
    this.memoryCache.set(cacheKey, profile);
    
    return profile;
  }

  // 用户统计缓存
  async getUserStats(userId: string) {
    const cacheKey = `stats:${userId}`;
    const cached = await this.redis.get(cacheKey);
    
    if (cached) return JSON.parse(cached);
    
    const stats = await this.calculateUserStats(userId);
    await this.redis.setex(cacheKey, 600, JSON.stringify(stats)); // 10分钟
    
    return stats;
  }

  // 清除用户相关缓存
  async invalidateUserCache(userId: string) {
    const keys = [
      `profile:${userId}`,
      `stats:${userId}`,
      `wallet:${userId}`,
      `achievements:${userId}`
    ];
    
    await Promise.all([
      this.redis.del(...keys),
      ...keys.map(key => this.memoryCache.delete(key))
    ]);
  }
}
```

### 5.2 图片优化

```typescript
// utils/avatarOptimization.ts
export class AvatarOptimizer {
  private cdn: CDNService;

  constructor() {
    this.cdn = new CDNService();
  }

  // 生成多尺寸头像
  async generateAvatarSizes(originalUrl: string) {
    const sizes = [24, 32, 48, 64, 96, 128, 256];
    
    return {
      original: originalUrl,
      sizes: sizes.reduce((acc, size) => {
        acc[size] = `${originalUrl}?w=${size}&h=${size}&fit=crop&f=webp&q=80`;
        return acc;
      }, {} as Record<number, string>),
      placeholder: `${originalUrl}?w=24&h=24&fit=crop&blur=10&q=30`
    };
  }

  // 智能头像加载
  getOptimalAvatarUrl(originalUrl: string, targetSize: number, retina = false) {
    const actualSize = retina ? targetSize * 2 : targetSize;
    const sizeOptions = [24, 32, 48, 64, 96, 128, 256];
    const optimalSize = sizeOptions.find(size => size >= actualSize) || 256;
    
    return `${originalUrl}?w=${optimalSize}&h=${optimalSize}&fit=crop&f=webp&q=80`;
  }
}
```

## 6. 总结

这个用户个人中心设计文档提供了完整的前后端实现规范，包括：

### 核心功能特性
1. **完整的用户资料管理** - 支持个人信息编辑和隐私设置
2. **创意作品管理** - 完整的创意生命周期管理
3. **钱包和交易系统** - 充值、提现、交易历史管理
4. **成就和等级系统** - 游戏化的用户激励机制
5. **活动历史跟踪** - 完整的用户行为记录

### 技术亮点
- **响应式设计**：完美适配桌面和移动端
- **多层缓存**：内存 + Redis + 数据库的缓存策略
- **实时更新**：WebSocket实现的实时数据同步
- **图片优化**：CDN + 多尺寸 + 懒加载
- **隐私保护**：细粒度的隐私控制

### 用户体验优化
- **直观的导航**：清晰的功能分类和导航结构
- **丰富的统计信息**：多维度的数据展示
- **流畅的交互**：动画效果和加载状态
- **个性化设置**：丰富的自定义选项

这个设计确保了用户个人中心能够提供全面、直观、高效的个人信息管理体验，增强用户对平台的粘性和满意度。