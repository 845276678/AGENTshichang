# 首页设计规范文档

## 1. 页面概述

### 1.1 页面职责
首页作为AI Agent市场的门户，承担以下核心功能：
- 产品价值传达和用户教育
- Agent展示和个性介绍  
- 用户引导和转化
- 实时活动展示，增强平台活力

### 1.2 目标用户
- **主要用户**：首次访问的潜在用户
- **次要用户**：回访用户快速导航

### 1.3 关键指标
- 注册转化率 > 15%
- 首次创意提交率 > 8%
- 页面停留时间 > 2分钟
- Agent详情查看率 > 40%

## 2. 前端设计规范

### 2.1 页面结构

```tsx
// pages/index.tsx
import { GetStaticProps } from 'next';
import { Hero } from '@/components/home/Hero';
import { AgentShowcase } from '@/components/home/AgentShowcase';
import { HowItWorks } from '@/components/home/HowItWorks';
import { LiveActivity } from '@/components/home/LiveActivity';
import { Testimonials } from '@/components/home/Testimonials';
import { CallToAction } from '@/components/home/CallToAction';

interface HomePageProps {
  agents: Agent[];
  recentActivities: Activity[];
  stats: PlatformStats;
  testimonials: Testimonial[];
}

export default function HomePage({ 
  agents, 
  recentActivities, 
  stats, 
  testimonials 
}: HomePageProps) {
  return (
    <div className="homepage">
      {/* 英雄区域 */}
      <Hero stats={stats} />
      
      {/* Agent展示区域 */}
      <AgentShowcase agents={agents} />
      
      {/* 工作流程说明 */}
      <HowItWorks />
      
      {/* 实时活动展示 */}
      <LiveActivity activities={recentActivities} />
      
      {/* 用户见证 */}
      <Testimonials testimonials={testimonials} />
      
      {/* 行动召唤 */}
      <CallToAction />
    </div>
  );
}

// 静态数据获取
export const getStaticProps: GetStaticProps = async () => {
  const [agents, activities, stats, testimonials] = await Promise.all([
    fetchAgents(),
    fetchRecentActivities(),
    fetchPlatformStats(),
    fetchTestimonials()
  ]);

  return {
    props: {
      agents,
      recentActivities: activities,
      stats,
      testimonials
    },
    revalidate: 300 // 5分钟重新生成
  };
};
```

### 2.2 组件设计规范

#### 2.2.1 Hero组件

```tsx
// components/home/Hero.tsx
import { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
import { AgentPreviewCircle } from './AgentPreviewCircle';
import { Button } from '@/components/ui/Button';

interface HeroProps {
  stats: PlatformStats;
}

export const Hero: React.FC<HeroProps> = ({ stats }) => {
  const [isClient, setIsClient] = useState(false);
  
  useEffect(() => {
    setIsClient(true);
  }, []);

  return (
    <section className="relative min-h-screen flex items-center justify-center overflow-hidden">
      {/* 动态背景 */}
      <div className="absolute inset-0 bg-gradient-to-br from-blue-50 via-white to-purple-50">
        <div className="absolute inset-0 bg-grid-pattern opacity-30" />
        {isClient && <ParticleBackground />}
      </div>
      
      <div className="container mx-auto px-4 z-10">
        <div className="grid lg:grid-cols-2 gap-12 items-center">
          {/* 左侧内容 */}
          <motion.div
            initial={{ opacity: 0, x: -50 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8 }}
            className="text-center lg:text-left"
          >
            <h1 className="text-4xl lg:text-6xl font-extrabold text-gray-900 mb-6">
              让你的
              <span className="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                创意
              </span>
              与
              <span className="bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">
                AI大师
              </span>
              碰撞出火花
            </h1>
            
            <p className="text-xl text-gray-600 mb-8 leading-relaxed">
              5位个性鲜明的AI专家为你的想法估价、改造、包装。
              见证创意如何在讨论中升值，体验前所未有的AI协作。
            </p>
            
            {/* 统计数据 */}
            <div className="grid grid-cols-3 gap-6 mb-8">
              <div className="text-center">
                <div className="text-2xl font-bold text-blue-600">
                  {stats.totalIdeas.toLocaleString()}+
                </div>
                <div className="text-sm text-gray-500">创意已升值</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">
                  {stats.activeUsers.toLocaleString()}+
                </div>
                <div className="text-sm text-gray-500">活跃用户</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-purple-600">
                  {Math.round(stats.averageValue * 100)}%
                </div>
                <div className="text-sm text-gray-500">平均升值</div>
              </div>
            </div>
            
            {/* 行动按钮 */}
            <div className="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
              <Button 
                size="lg" 
                variant="primary"
                href="/submit"
                className="text-lg px-8 py-4"
              >
                提交你的第一个创意
                <ArrowRightIcon className="ml-2 w-5 h-5" />
              </Button>
              
              <Button 
                size="lg" 
                variant="secondary"
                onClick={() => setShowDemo(true)}
                className="text-lg px-8 py-4"
              >
                <PlayIcon className="mr-2 w-5 h-5" />
                观看演示视频
              </Button>
            </div>
          </motion.div>
          
          {/* 右侧Agent预览圈 */}
          <motion.div
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 1, delay: 0.3 }}
            className="flex justify-center"
          >
            <AgentPreviewCircle />
          </motion.div>
        </div>
      </div>
    </section>
  );
};
```

#### 2.2.2 Agent展示组件

```tsx
// components/home/AgentShowcase.tsx
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { AgentCard } from '@/components/agents/AgentCard';
import { AgentDetailModal } from '@/components/agents/AgentDetailModal';

interface AgentShowcaseProps {
  agents: Agent[];
}

export const AgentShowcase: React.FC<AgentShowcaseProps> = ({ agents }) => {
  const [selectedAgent, setSelectedAgent] = useState<Agent | null>(null);
  const [hoveredAgent, setHoveredAgent] = useState<string | null>(null);

  return (
    <section id="agents" className="py-24 bg-white">
      <div className="container mx-auto px-4">
        {/* 区块标题 */}
        <div className="text-center mb-16">
          <motion.h2 
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6 }}
            className="text-3xl lg:text-4xl font-bold text-gray-900 mb-4"
          >
            认识我们的5位AI专家
          </motion.h2>
          <motion.p 
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.1 }}
            className="text-xl text-gray-600 max-w-2xl mx-auto"
          >
            每位Agent都有独特的专业背景和评估风格，为你的创意提供全方位的价值提升
          </motion.p>
        </div>
        
        {/* Agent网格 */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
          {agents.map((agent, index) => (
            <motion.div
              key={agent.id}
              initial={{ opacity: 0, y: 50 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: index * 0.1 }}
              onHoverStart={() => setHoveredAgent(agent.id)}
              onHoverEnd={() => setHoveredAgent(null)}
            >
              <AgentCard
                agent={agent}
                isHovered={hoveredAgent === agent.id}
                onClick={() => setSelectedAgent(agent)}
                showStats={true}
              />
            </motion.div>
          ))}
        </div>
        
        {/* 交互提示 */}
        <motion.div 
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          transition={{ duration: 0.6, delay: 0.5 }}
          className="text-center mt-12"
        >
          <p className="text-gray-500 mb-4">点击查看每位专家的详细介绍</p>
          <div className="flex justify-center items-center space-x-2">
            <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" />
            <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }} />
            <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }} />
          </div>
        </motion.div>
      </div>
      
      {/* Agent详情弹窗 */}
      <AnimatePresence>
        {selectedAgent && (
          <AgentDetailModal
            agent={selectedAgent}
            onClose={() => setSelectedAgent(null)}
          />
        )}
      </AnimatePresence>
    </section>
  );
};
```

### 2.3 数据类型定义

```typescript
// types/home.ts
export interface PlatformStats {
  totalIdeas: number;
  activeUsers: number;
  averageValue: number;
  successfulTransactions: number;
  agentEarnings: number;
}

export interface Activity {
  id: string;
  type: 'idea_submitted' | 'discussion_started' | 'idea_purchased' | 'agent_joined';
  timestamp: string;
  user?: {
    id: string;
    username: string;
    avatar?: string;
  };
  agent?: {
    id: string;
    name: string;
    avatar: string;
  };
  idea?: {
    id: string;
    title: string;
    category: string;
  };
  metadata?: Record<string, any>;
}

export interface Testimonial {
  id: string;
  user: {
    name: string;
    avatar: string;
    title: string;
  };
  content: string;
  rating: number;
  createdAt: string;
  idea?: {
    title: string;
    originalValue: number;
    enhancedValue: number;
  };
}

export interface Agent {
  id: string;
  name: string;
  title: string;
  specialty: string;
  avatar: string;
  description: string;
  personality: string[];
  stats: {
    ideasEvaluated: number;
    averageBid: number;
    successRate: number;
    userSatisfaction: number;
  };
  signatureQuote: string;
  color: {
    primary: string;
    secondary: string;
    gradient: string;
  };
  isOnline: boolean;
  currentActivity?: string;
}
```

## 3. 后端API规范

### 3.1 API端点定义

#### 3.1.1 获取平台统计数据

```typescript
// GET /api/stats/platform
export interface PlatformStatsResponse {
  success: boolean;
  data: {
    totalIdeas: number;
    activeUsers: number;
    averageValue: number;
    successfulTransactions: number;
    agentEarnings: number;
    lastUpdated: string;
  };
}

// 实现示例
export async function GET() {
  try {
    const stats = await prisma.$transaction([
      prisma.idea.count(),
      prisma.user.count({ where: { lastActiveAt: { gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000) } } }),
      prisma.enhancement.aggregate({ _avg: { valueIncrease: true } }),
      prisma.transaction.count({ where: { status: 'completed' } }),
      prisma.agentEarning.aggregate({ _sum: { amount: true } })
    ]);

    return NextResponse.json({
      success: true,
      data: {
        totalIdeas: stats[0],
        activeUsers: stats[1],
        averageValue: stats[2]._avg.valueIncrease || 0,
        successfulTransactions: stats[3],
        agentEarnings: stats[4]._sum.amount || 0,
        lastUpdated: new Date().toISOString()
      }
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to fetch platform stats' },
      { status: 500 }
    );
  }
}
```

#### 3.1.2 获取Agent列表

```typescript
// GET /api/agents
export interface AgentsResponse {
  success: boolean;
  data: Agent[];
}

// 实现示例
export async function GET() {
  try {
    const agents = await prisma.agent.findMany({
      include: {
        _count: {
          select: {
            evaluations: true,
            purchasedIdeas: true
          }
        },
        earnings: {
          select: {
            totalEarnings: true,
            averageRating: true
          }
        }
      }
    });

    const formattedAgents = agents.map(agent => ({
      id: agent.id,
      name: agent.name,
      title: agent.title,
      specialty: agent.specialty,
      avatar: agent.avatar,
      description: agent.description,
      personality: agent.personality,
      stats: {
        ideasEvaluated: agent._count.evaluations,
        averageBid: calculateAverageBid(agent.id),
        successRate: calculateSuccessRate(agent.id),
        userSatisfaction: agent.earnings?.averageRating || 0
      },
      signatureQuote: agent.signatureQuote,
      color: agent.colorScheme,
      isOnline: checkAgentOnlineStatus(agent.id),
      currentActivity: getCurrentActivity(agent.id)
    }));

    return NextResponse.json({
      success: true,
      data: formattedAgents
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to fetch agents' },
      { status: 500 }
    );
  }
}
```

#### 3.1.3 获取最近活动

```typescript
// GET /api/activities/recent?limit=10
export interface RecentActivitiesResponse {
  success: boolean;
  data: Activity[];
  pagination: {
    total: number;
    limit: number;
    offset: number;
  };
}

// 实现示例
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const limit = parseInt(searchParams.get('limit') || '10');
  const offset = parseInt(searchParams.get('offset') || '0');

  try {
    const [activities, total] = await Promise.all([
      prisma.activity.findMany({
        take: limit,
        skip: offset,
        orderBy: { createdAt: 'desc' },
        include: {
          user: {
            select: { id: true, username: true, avatar: true }
          },
          agent: {
            select: { id: true, name: true, avatar: true }
          },
          idea: {
            select: { id: true, title: true, category: true }
          }
        }
      }),
      prisma.activity.count()
    ]);

    return NextResponse.json({
      success: true,
      data: activities,
      pagination: { total, limit, offset }
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to fetch recent activities' },
      { status: 500 }
    );
  }
}
```

#### 3.1.4 获取用户见证

```typescript
// GET /api/testimonials?featured=true
export interface TestimonialsResponse {
  success: boolean;
  data: Testimonial[];
}

// 实现示例
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const featured = searchParams.get('featured') === 'true';

  try {
    const testimonials = await prisma.testimonial.findMany({
      where: featured ? { isFeatured: true } : {},
      take: featured ? 6 : 20,
      orderBy: { createdAt: 'desc' },
      include: {
        user: {
          select: { name: true, avatar: true, title: true }
        },
        idea: {
          select: { 
            title: true, 
            originalValue: true, 
            enhancedValue: true 
          }
        }
      }
    });

    return NextResponse.json({
      success: true,
      data: testimonials
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Failed to fetch testimonials' },
      { status: 500 }
    );
  }
}
```

### 3.2 数据库模型

```sql
-- Platform statistics table (for caching)
CREATE TABLE platform_stats (
  id SERIAL PRIMARY KEY,
  stat_name VARCHAR(50) UNIQUE NOT NULL,
  stat_value BIGINT NOT NULL,
  last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Activities table for real-time feed
CREATE TABLE activities (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  type VARCHAR(50) NOT NULL,
  user_id UUID REFERENCES users(id),
  agent_id VARCHAR(20) REFERENCES agents(id),
  idea_id UUID REFERENCES ideas(id),
  metadata JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Testimonials table
CREATE TABLE testimonials (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) NOT NULL,
  idea_id UUID REFERENCES ideas(id),
  content TEXT NOT NULL,
  rating INTEGER CHECK (rating >= 1 AND rating <= 5),
  is_featured BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Agent performance cache
CREATE TABLE agent_performance_cache (
  agent_id VARCHAR(20) PRIMARY KEY REFERENCES agents(id),
  total_evaluations INTEGER DEFAULT 0,
  average_bid DECIMAL(10,2) DEFAULT 0,
  success_rate DECIMAL(5,4) DEFAULT 0,
  user_satisfaction DECIMAL(3,2) DEFAULT 0,
  last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 4. 性能优化策略

### 4.1 前端优化

```typescript
// 图片懒加载和优化
const OptimizedImage = ({ src, alt, ...props }) => (
  <Image
    src={src}
    alt={alt}
    placeholder="blur"
    blurDataURL="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
    loading="lazy"
    {...props}
  />
);

// 组件代码分割
const AgentDetailModal = dynamic(
  () => import('@/components/agents/AgentDetailModal'),
  { 
    loading: () => <ModalSkeleton />,
    ssr: false 
  }
);

// 数据预获取
export const getStaticProps: GetStaticProps = async () => {
  // 并行获取数据
  const [agents, activities, stats] = await Promise.all([
    fetchAgents(),
    fetchRecentActivities(10),
    fetchPlatformStats()
  ]);

  return {
    props: { agents, activities, stats },
    revalidate: 300 // ISR重新生成间隔
  };
};
```

### 4.2 后端优化

```typescript
// Redis缓存策略
const CACHE_KEYS = {
  PLATFORM_STATS: 'platform:stats',
  AGENTS_LIST: 'agents:list',
  RECENT_ACTIVITIES: 'activities:recent'
};

// 缓存实现
export async function getCachedPlatformStats() {
  const cached = await redis.get(CACHE_KEYS.PLATFORM_STATS);
  
  if (cached) {
    return JSON.parse(cached);
  }
  
  const stats = await fetchPlatformStats();
  await redis.setex(CACHE_KEYS.PLATFORM_STATS, 300, JSON.stringify(stats));
  
  return stats;
}

// 数据库查询优化
export async function getAgentsWithPerformance() {
  return await prisma.agent.findMany({
    select: {
      id: true,
      name: true,
      title: true,
      avatar: true,
      description: true,
      // 使用预计算的性能数据
      performanceCache: true
    }
  });
}
```

## 5. 监控和分析

### 5.1 关键指标追踪

```typescript
// 用户行为追踪
export const trackUserAction = (action: string, properties?: Record<string, any>) => {
  // Google Analytics 4
  gtag('event', action, {
    page_title: document.title,
    page_location: window.location.href,
    ...properties
  });
  
  // 自定义分析
  analytics.track(action, {
    timestamp: new Date().toISOString(),
    sessionId: getSessionId(),
    userId: getCurrentUserId(),
    ...properties
  });
};

// 页面性能监控
export const trackPagePerformance = () => {
  const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;
  
  analytics.track('page_performance', {
    loadTime: navigation.loadEventEnd - navigation.fetchStart,
    domContentLoaded: navigation.domContentLoadedEventEnd - navigation.fetchStart,
    firstContentfulPaint: getFirstContentfulPaint(),
    largestContentfulPaint: getLargestContentfulPaint()
  });
};
```

### 5.2 A/B测试框架

```typescript
// 首页A/B测试配置
export const useHomepageExperiment = () => {
  const { experiment, variant } = useExperiment('homepage_hero_v2');
  
  return {
    showNewHero: variant === 'new_hero',
    showAnimatedStats: variant === 'animated_stats',
    trackConversion: (action: string) => {
      experiment.track('conversion', { action });
    }
  };
};
```

## 6. 安全性考虑

```typescript
// API请求限制
export const rateLimitConfig = {
  '/api/stats/*': { windowMs: 60000, max: 30 }, // 每分钟30次
  '/api/agents': { windowMs: 60000, max: 60 },   // 每分钟60次
  '/api/activities/*': { windowMs: 60000, max: 100 } // 每分钟100次
};

// 数据验证
export const validateStatsRequest = (request: Request) => {
  // IP白名单检查
  const clientIP = getClientIP(request);
  if (!isAllowedIP(clientIP)) {
    throw new Error('Access denied');
  }
  
  // 请求频率检查
  if (!checkRateLimit(clientIP, '/api/stats')) {
    throw new Error('Rate limit exceeded');
  }
};
```

这个首页设计文档为前后端协作提供了清晰的规范和接口定义，确保开发过程中的高效协作和正确对接。