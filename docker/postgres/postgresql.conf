# PostgreSQL生产环境配置
# 性能相关配置
shared_buffers = 256MB                  # 共享缓冲区大小
effective_cache_size = 1GB              # 可用缓存估算
work_mem = 4MB                          # 工作内存
maintenance_work_mem = 64MB             # 维护工作内存
checkpoint_completion_target = 0.9      # 检查点完成目标
wal_buffers = 16MB                      # WAL缓冲区大小
default_statistics_target = 100         # 统计目标

# 连接相关配置
max_connections = 200                   # 最大连接数
shared_preload_libraries = 'pg_stat_statements'  # 预加载库

# 日志相关配置
logging_collector = on                  # 启用日志收集
log_directory = 'pg_log'               # 日志目录
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'  # 日志文件名
log_rotation_age = 1d                  # 日志轮转时间
log_rotation_size = 100MB              # 日志轮转大小
log_min_duration_statement = 1000      # 记录慢查询（1秒）
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,client=%h '  # 日志前缀
log_checkpoints = on                   # 记录检查点
log_connections = on                   # 记录连接
log_disconnections = on                # 记录断开连接
log_lock_waits = on                    # 记录锁等待

# 复制相关配置
wal_level = replica                    # WAL级别
max_wal_senders = 3                    # 最大WAL发送者
wal_keep_segments = 64                 # 保留WAL段数
archive_mode = on                      # 启用归档模式
archive_command = 'cp %p /var/lib/postgresql/archive/%f'  # 归档命令

# 安全相关配置
ssl = on                               # 启用SSL
ssl_cert_file = 'server.crt'          # SSL证书文件
ssl_key_file = 'server.key'           # SSL密钥文件

# 时区配置
timezone = 'Asia/Shanghai'             # 时区设置
log_timezone = 'Asia/Shanghai'         # 日志时区

# 其他优化配置
random_page_cost = 1.1                 # 随机页面成本
seq_page_cost = 1.0                    # 顺序页面成本
effective_io_concurrency = 200         # 有效IO并发